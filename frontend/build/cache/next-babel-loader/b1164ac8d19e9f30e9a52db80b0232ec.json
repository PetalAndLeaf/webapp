{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport { db, fieldDelete } from './fire';\nimport { ProfileStructure } from '../utils/types'; // import { toPureObjectArray } from '../utils/helper'\n\n/********* *******    NOTICE ON AUTH ******* *************/\n\n/* ALL  read and write operation assumes that user is signed in\n ** this check is done in 1) action createors at client\n ** and 2) firestore rule in database */\n\n/************************ READ *****************************/\n\nvar fetchDoc =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(path) {\n    var docRef, doc;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return db.doc(path).get();\n\n          case 2:\n            docRef = _context.sent;\n            doc = docRef.data();\n            return _context.abrupt(\"return\", doc);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function fetchDoc(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar fetchDocs =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(collection) {\n    var orderBy,\n        docsQuerySnapshot,\n        docs,\n        _args2 = arguments;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            orderBy = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : '';\n            _context2.next = 3;\n            return db.collection(collection).orderBy(orderBy).get();\n\n          case 3:\n            docsQuerySnapshot = _context2.sent;\n            docs = [];\n            docsQuerySnapshot.forEach(function (doc) {\n              docs.push(_objectSpread({}, doc.data(), {\n                id: doc.id\n              }));\n            });\n            return _context2.abrupt(\"return\", docs);\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function fetchDocs(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}(); // Home page data\n\n\nexport var fetchProductList =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3() {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return fetchDocs('products', 'order');\n\n          case 2:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function fetchProductList() {\n    return _ref3.apply(this, arguments);\n  };\n}(); // Product detail page data\n\nexport var fetchProduct =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(id) {\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return fetchDoc(\"products/\".concat(id));\n\n          case 2:\n            return _context4.abrupt(\"return\", _context4.sent);\n\n          case 3:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function fetchProduct(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var fetchProductStory =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(id) {\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return fetchDoc(\"products/\".concat(id, \"/stories/2019EN\"));\n\n          case 2:\n            return _context5.abrupt(\"return\", _context5.sent);\n\n          case 3:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function fetchProductStory(_x4) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var getUserProfile =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee6(uid) {\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return fetchDoc(\"users/\".concat(uid));\n\n          case 2:\n            return _context6.abrupt(\"return\", _context6.sent);\n\n          case 3:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function getUserProfile(_x5) {\n    return _ref6.apply(this, arguments);\n  };\n}(); // Listener for User Profile Data\n// return unsubscriobe function\n// pass as return in useEffect hook to\n// unsubscriobe when component unmount\n// For Account/Address USE\n\nexport function onUserProfileChange(uid, onNext, onError) {\n  return db.doc(\"users/\".concat(uid)).onSnapshot(onNext, onError);\n} // const getAddress = (snapshot: any) => {\n//   const addressList = snapshot.data().addressList\n//   addressList && setAddresses(addressList)\n// }\n// const getAddrErr = (err: any) => {\n//   console.log(err)\n// }\n// export const userAddressListener = (uid: string, getUserAddr: Function) => {\n//   onUserProfileChange(uid, getAddress, getAddrErr)\n// }\n\n/*********************** WRITE  BASIC OPERATIONS*******************/\n\nvar writeDoc =\n/*#__PURE__*/\nfunction () {\n  var _ref7 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee7(type, col, docID, data) {\n    var path, removeSytax;\n    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            path = \"\".concat(col, \"/\").concat(docID);\n            _context7.prev = 1;\n            _context7.t0 = type;\n            _context7.next = _context7.t0 === 'set' ? 5 : _context7.t0 === 'update' ? 8 : _context7.t0 === 'delete' ? 11 : _context7.t0 === 'deleteField' ? 14 : 18;\n            break;\n\n          case 5:\n            _context7.next = 7;\n            return db.doc(path).set(data);\n\n          case 7:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 8:\n            _context7.next = 10;\n            return db.doc(path).update(data);\n\n          case 10:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 11:\n            _context7.next = 13;\n            return db.doc(path)[\"delete\"]();\n\n          case 13:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 14:\n            //see firebase reference\n            removeSytax = _defineProperty({}, data, fieldDelete);\n            _context7.next = 17;\n            return db.doc(path).update(removeSytax);\n\n          case 17:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 18:\n            console.log('Incorrect firebase write opertion type');\n\n          case 19:\n            _context7.next = 24;\n            break;\n\n          case 21:\n            _context7.prev = 21;\n            _context7.t1 = _context7[\"catch\"](1);\n            console.log('Firebase Write to Doc Err ', _context7.t1);\n\n          case 24:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[1, 21]]);\n  }));\n\n  return function writeDoc(_x6, _x7, _x8, _x9) {\n    return _ref7.apply(this, arguments);\n  };\n}();\n/******************************************************************/\n\n\nexport var deleteUserField =\n/*#__PURE__*/\nfunction () {\n  var _ref8 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee8(uid, fieldToRemove) {\n    return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.prev = 0;\n            _context8.next = 3;\n            return writeDoc('deleteField', 'users', uid, fieldToRemove);\n\n          case 3:\n            _context8.next = 8;\n            break;\n\n          case 5:\n            _context8.prev = 5;\n            _context8.t0 = _context8[\"catch\"](0);\n            console.log('err delete field ', _context8.t0);\n\n          case 8:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[0, 5]]);\n  }));\n\n  return function deleteUserField(_x10, _x11) {\n    return _ref8.apply(this, arguments);\n  };\n}();\nexport var createUserProfile =\n/*#__PURE__*/\nfunction () {\n  var _ref9 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee9(userinfo) {\n    var uid, email, profile;\n    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            uid = userinfo.uid, email = userinfo.email;\n            profile = new ProfileStructure({\n              email: email\n            });\n            _context9.prev = 2;\n            _context9.next = 5;\n            return writeDoc('set', 'users', uid, profile.toObject());\n\n          case 5:\n            _context9.next = 10;\n            break;\n\n          case 7:\n            _context9.prev = 7;\n            _context9.t0 = _context9[\"catch\"](2);\n            console.log('Firebase Create Doc Err ', _context9.t0);\n\n          case 10:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9, null, [[2, 7]]);\n  }));\n\n  return function createUserProfile(_x12) {\n    return _ref9.apply(this, arguments);\n  };\n}();\n\nvar updateUserProfileField =\n/*#__PURE__*/\nfunction () {\n  var _ref10 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee10(uid, field, data) {\n    var newFieldData;\n    return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            // demonstrate how to user var as key of object in ES6\n            console.log(\"update: {\".concat(_JSON$stringify(field), \" : \").concat(_JSON$stringify(data), \" }\"));\n            newFieldData = _defineProperty({}, field, data);\n            _context10.prev = 2;\n            _context10.next = 5;\n            return writeDoc('update', 'users', uid, newFieldData);\n\n          case 5:\n            _context10.next = 10;\n            break;\n\n          case 7:\n            _context10.prev = 7;\n            _context10.t0 = _context10[\"catch\"](2);\n            console.log(_context10.t0);\n\n          case 10:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10, null, [[2, 7]]);\n  }));\n\n  return function updateUserProfileField(_x13, _x14, _x15) {\n    return _ref10.apply(this, arguments);\n  };\n}(); //including update already exist and delete from the list.\n\n\nexport var updateUserAddress =\n/*#__PURE__*/\nfunction () {\n  var _ref11 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee11(uid, addressList) {\n    return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            _context11.prev = 0;\n            _context11.next = 3;\n            return updateUserProfileField(uid, 'addressList', addressList);\n\n          case 3:\n            return _context11.abrupt(\"return\", _context11.sent);\n\n          case 6:\n            _context11.prev = 6;\n            _context11.t0 = _context11[\"catch\"](0);\n            console.log('err updateUserAddress', _context11.t0);\n\n          case 9:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, _callee11, null, [[0, 6]]);\n  }));\n\n  return function updateUserAddress(_x16, _x17) {\n    return _ref11.apply(this, arguments);\n  };\n}();\nexport var deleteUserAddress =\n/*#__PURE__*/\nfunction () {\n  var _ref12 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee12(uid) {\n    return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            return _context12.abrupt(\"return\", uid);\n\n          case 1:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }, _callee12);\n  }));\n\n  return function deleteUserAddress(_x18) {\n    return _ref12.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/jianruan/Developer/webapp/frontend/lib/db.tsx"],"names":["db","fieldDelete","ProfileStructure","fetchDoc","path","doc","get","docRef","data","fetchDocs","collection","orderBy","docsQuerySnapshot","docs","forEach","push","id","fetchProductList","fetchProduct","fetchProductStory","getUserProfile","uid","onUserProfileChange","onNext","onError","onSnapshot","writeDoc","type","col","docID","set","update","removeSytax","console","log","deleteUserField","fieldToRemove","createUserProfile","userinfo","email","profile","toObject","updateUserProfileField","field","newFieldData","updateUserAddress","addressList","deleteUserAddress"],"mappings":"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","sourcesContent":["import { db, fieldDelete } from './fire'\nimport { SingUpForm, ProfileStructure } from '../utils/types'\n// import { toPureObjectArray } from '../utils/helper'\n\n/********* *******    NOTICE ON AUTH ******* *************/\n/* ALL  read and write operation assumes that user is signed in\n ** this check is done in 1) action createors at client\n ** and 2) firestore rule in database */\n\n/************************ READ *****************************/\nconst fetchDoc = async (path: string) => {\n  const docRef = await db.doc(path).get()\n  const doc = docRef.data()\n  return doc\n}\n\nconst fetchDocs = async (collection: string, orderBy: string = '') => {\n  const docsQuerySnapshot = await db\n    .collection(collection)\n    .orderBy(orderBy)\n    .get()\n\n  const docs: any[] = []\n  docsQuerySnapshot.forEach((doc: any) => {\n    docs.push({ ...doc.data(), id: doc.id })\n  })\n  return docs\n}\n\n// Home page data\nexport const fetchProductList = async () => {\n  return await fetchDocs('products', 'order')\n}\n\n// Product detail page data\nexport const fetchProduct = async (id: string) => {\n  return await fetchDoc(`products/${id}`)\n}\nexport const fetchProductStory = async (id: string) => {\n  return await fetchDoc(`products/${id}/stories/2019EN`)\n}\n\nexport const getUserProfile = async (uid: string) => {\n  return await fetchDoc(`users/${uid}`)\n}\n\n// Listener for User Profile Data\n// return unsubscriobe function\n// pass as return in useEffect hook to\n// unsubscriobe when component unmount\n// For Account/Address USE\nexport function onUserProfileChange(\n  uid: string,\n  onNext: (snapshot: any) => void,\n  onError: (error: any) => void\n) {\n  return db.doc(`users/${uid}`).onSnapshot(onNext, onError)\n}\n\n// const getAddress = (snapshot: any) => {\n//   const addressList = snapshot.data().addressList\n//   addressList && setAddresses(addressList)\n// }\n// const getAddrErr = (err: any) => {\n//   console.log(err)\n// }\n// export const userAddressListener = (uid: string, getUserAddr: Function) => {\n//   onUserProfileChange(uid, getAddress, getAddrErr)\n// }\n\n/*********************** WRITE  BASIC OPERATIONS*******************/\nconst writeDoc = async (\n  type: string,\n  col: string,\n  docID: string,\n  data: any\n) => {\n  const path = `${col}/${docID}`\n  try {\n    // const docRef = db.doc(`${col}/${docID}`)\n    switch (type) {\n      case 'set':\n        return await db.doc(path).set(data)\n      case 'update':\n        return await db.doc(path).update(data)\n      case 'delete': //delete ENTIRE DOC, NOT A FIELD\n        return await db.doc(path).delete()\n      case 'deleteField': //see firebase reference\n        const removeSytax = {\n          [data]: fieldDelete\n        }\n        return await db.doc(path).update(removeSytax)\n      default:\n        console.log('Incorrect firebase write opertion type')\n    }\n  } catch (err) {\n    console.log('Firebase Write to Doc Err ', err)\n  }\n}\n/******************************************************************/\n\nexport const deleteUserField = async (uid: string, fieldToRemove: string) => {\n  try {\n    await writeDoc('deleteField', 'users', uid, fieldToRemove)\n  } catch (err) {\n    console.log('err delete field ', err)\n  }\n}\n\nexport const createUserProfile = async (userinfo: SingUpForm) => {\n  const { uid, email } = userinfo\n  const profile = new ProfileStructure({ email: email })\n  try {\n    await writeDoc('set', 'users', uid, profile.toObject())\n  } catch (err) {\n    console.log('Firebase Create Doc Err ', err)\n  }\n}\n\nconst updateUserProfileField = async (\n  uid: string,\n  field: string,\n  data: any\n) => {\n  // demonstrate how to user var as key of object in ES6\n  console.log(`update: {${JSON.stringify(field)} : ${JSON.stringify(data)} }`)\n  const newFieldData = {\n    [field]: data\n  }\n  try {\n    await writeDoc('update', 'users', uid, newFieldData)\n  } catch (err) {\n    console.log(err)\n  }\n}\n\n//including update already exist and delete from the list.\nexport const updateUserAddress = async (uid: string, addressList: any[]) => {\n  try {\n    return await updateUserProfileField(uid, 'addressList', addressList)\n  } catch (err) {\n    console.log('err updateUserAddress', err)\n  }\n}\n\nexport const deleteUserAddress = async (uid: string) => {\n  return uid\n}\n"]},"metadata":{},"sourceType":"module"}