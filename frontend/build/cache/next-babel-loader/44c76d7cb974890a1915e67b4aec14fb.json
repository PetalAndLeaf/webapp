{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/jianruan/Developer/webapp/frontend/pages/account/address.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport { Typography } from '@material-ui/core';\nimport AccountLayout from '../../layout/AccountLayout';\nimport styled from 'styled-components';\nimport RoundedBtn from '../../components/Button/RoundedBtn';\nimport { AddressFormType } from '../../utils/types';\nimport { AsYouType } from 'libphonenumber-js';\nimport AddressBox from '../../components/Address/AddressBox';\nimport AddressForm from '../../components/Address/AddressForm';\nimport { onUserProfileChange, updateUserAddress } from '../../lib/db';\nimport { isEmpty } from 'lodash';\nimport { AddressToPureObjectArray } from '../../utils/helper';\nimport Router from 'next/router';\nvar Header = styled.div.withConfig({\n  displayName: \"address__Header\",\n  componentId: \"sc-1oaf82c-0\"\n})([\"height:64px;min-height:64px;display:flex;align-items:center;margin-bottom:16px;\"]);\nvar DEFAULT = 0;\nvar EDITTING = 1;\nvar ADDINGNEW = 2;\nexport default function Address() {\n  var currentUser = useSelector(function (state) {\n    return state.user.currentUser;\n  });\n  var uid = currentUser ? currentUser.uid : '';\n\n  var _useState = useState([]),\n      addresses = _useState[0],\n      setAddresses = _useState[1];\n\n  var getAddress = function getAddress(snapshot) {\n    var addressList = snapshot.data().addressList;\n    addressList && setAddresses(addressList);\n  };\n\n  var getAddrErr = function getAddrErr(err) {\n    console.log(err);\n  }; // 0 - default, 1 - editing, 2 - add new\n\n\n  var _useState2 = useState(DEFAULT),\n      mode = _useState2[0],\n      setMode = _useState2[1];\n\n  var _useState3 = useState(new AddressFormType()),\n      editingAddress = _useState3[0],\n      setEditingAddress = _useState3[1];\n\n  var _useState4 = useState(-1),\n      editingIndex = _useState4[0],\n      setEditingIndex = _useState4[1];\n\n  useEffect(function () {\n    var profileListener = onUserProfileChange(uid, getAddress, getAddrErr);\n    return function () {\n      return profileListener();\n    }; //unsubscribe when unmount\n  }, []);\n\n  var handleAddClick = function handleAddClick() {\n    setEditingAddress(new AddressFormType());\n    setMode(ADDINGNEW);\n  };\n\n  var handleEditClick = function handleEditClick(addr, editingIndex) {\n    var formatted = new AsYouType('US').input(addr.phone);\n    var currentAddress = new AddressFormType({\n      fullname: addr.fullname,\n      line1: addr.line1,\n      line2: addr.line2 || '',\n      city: addr.city,\n      state: addr.state,\n      zipcode: addr.zipcode,\n      phone: addr.phone,\n      formattedPhone: formatted,\n      isValid: false\n    });\n    setEditingAddress(currentAddress);\n    setMode(EDITTING);\n    setEditingIndex(editingIndex);\n  };\n\n  var handleAddressDelete = function handleAddressDelete(addressIndex) {\n    var newAddresses = addresses.slice();\n    newAddresses.splice(addressIndex, 1);\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses));\n  };\n\n  var handleSetAsDefault = function handleSetAsDefault(addressIndex) {\n    var newAddresses = addresses.slice();\n    newAddresses.forEach(function (addr, i) {\n      if (i === addressIndex) {\n        addr.isDefault = true;\n      } else {\n        addr.isDefault = false;\n      }\n    });\n    var defaultAddress = newAddresses[addressIndex];\n    newAddresses.splice(addressIndex, 1);\n    newAddresses.unshift(defaultAddress);\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses));\n  };\n\n  var handleAddressSubmit = function handleAddressSubmit(newAddress) {\n    var newAddresses = addresses.slice();\n\n    if (mode === EDITTING) {\n      newAddresses.splice(editingIndex, 1, newAddress);\n    } else if (mode === ADDINGNEW) {\n      //if first/only add addr, auto set as default\n      //addr list garantee 1 default addr\n      if (isEmpty(newAddresses)) {\n        newAddress.isDefault = true;\n      }\n\n      newAddresses.push(newAddress);\n    }\n\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses)); // console.log('Updates/New address: ', newAddress)\n\n    setMode(DEFAULT);\n    setEditingIndex(-1);\n    setEditingAddress(new AddressFormType());\n  };\n\n  return __jsx(AccountLayout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114\n    },\n    __self: this\n  }, __jsx(Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, __jsx(Typography, {\n    variant: \"h4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, mode === EDITTING ? 'Edit your shipping address' : mode === ADDINGNEW ? 'Add shipping address' : 'Manage your shipping address')), mode === DEFAULT && !isEmpty(addresses) && addresses.map(function (addr, i) {\n    return __jsx(AddressBox, {\n      address: addr,\n      key: \"address-\".concat(i),\n      onEdit: function onEdit() {\n        return handleEditClick(addr, i);\n      },\n      onDelete: function onDelete() {\n        return handleAddressDelete(i);\n      },\n      onSetAsDefault: function onSetAsDefault() {\n        return handleSetAsDefault(i);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    });\n  }), mode !== DEFAULT && __jsx(AddressForm, {\n    initAddress: editingAddress,\n    submitBtn: {\n      label: 'Save',\n      handleClick: handleAddressSubmit\n    },\n    handleCancel: function handleCancel() {\n      return setMode(DEFAULT);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }), mode === DEFAULT && __jsx(RoundedBtn, {\n    onClick: handleAddClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, \"Add address\"));\n}\n\nAddress.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(ctx) {\n    var store, isServer, isLoggedin;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            store = ctx.store, isServer = ctx.isServer;\n            isLoggedin = store.getState().user.isLoggedin;\n\n            if (!isLoggedin) {\n              if (isServer) {\n                ctx.res.writeHead(302, {\n                  Location: \"/\"\n                });\n                ctx.res.end();\n              } else {\n                Router.push('/');\n              }\n            }\n\n            return _context.abrupt(\"return\", {\n              isServer: isServer\n            });\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/jianruan/Developer/webapp/frontend/pages/account/address.tsx"],"names":["React","useState","useEffect","useSelector","Typography","AccountLayout","styled","RoundedBtn","AddressFormType","AsYouType","AddressBox","AddressForm","onUserProfileChange","updateUserAddress","isEmpty","AddressToPureObjectArray","Router","Header","div","DEFAULT","EDITTING","ADDINGNEW","Address","currentUser","state","user","uid","addresses","setAddresses","getAddress","snapshot","addressList","data","getAddrErr","err","console","log","mode","setMode","editingAddress","setEditingAddress","editingIndex","setEditingIndex","profileListener","handleAddClick","handleEditClick","addr","formatted","input","phone","currentAddress","fullname","line1","line2","city","zipcode","formattedPhone","isValid","handleAddressDelete","addressIndex","newAddresses","slice","splice","handleSetAsDefault","forEach","i","isDefault","defaultAddress","unshift","handleAddressSubmit","newAddress","push","map","label","handleClick","getInitialProps","ctx","store","isServer","isLoggedin","getState","res","writeHead","Location","end"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { useSelector } from 'react-redux'\nimport { Typography } from '@material-ui/core'\nimport AccountLayout from '../../layout/AccountLayout'\nimport styled from 'styled-components'\nimport RoundedBtn from '../../components/Button/RoundedBtn'\nimport { AddressFormType } from '../../utils/types'\nimport { AsYouType } from 'libphonenumber-js'\nimport AddressBox from '../../components/Address/AddressBox'\nimport AddressForm from '../../components/Address/AddressForm'\nimport { onUserProfileChange, updateUserAddress } from '../../lib/db'\nimport { isEmpty } from 'lodash'\nimport { AddressToPureObjectArray } from '../../utils/helper'\nimport Router from 'next/router'\n\nconst Header = styled.div`\n  height: 64px;\n  min-height: 64px;\n  display: flex;\n  align-items: center;\n  margin-bottom: 16px;\n`\n\nconst DEFAULT = 0\nconst EDITTING = 1\nconst ADDINGNEW = 2\n\nexport default function Address() {\n  const currentUser = useSelector((state: any) => state.user.currentUser)\n  const uid = currentUser ? currentUser.uid : ''\n  const [addresses, setAddresses] = useState<AddressFormType[]>([])\n\n  const getAddress = (snapshot: any) => {\n    const addressList = snapshot.data().addressList\n    addressList && setAddresses(addressList)\n  }\n  const getAddrErr = (err: any) => {\n    console.log(err)\n  }\n\n  // 0 - default, 1 - editing, 2 - add new\n  const [mode, setMode] = useState(DEFAULT)\n  const [editingAddress, setEditingAddress] = useState(new AddressFormType())\n  const [editingIndex, setEditingIndex] = useState(-1)\n\n  useEffect(() => {\n    const profileListener = onUserProfileChange(uid, getAddress, getAddrErr)\n    return () => profileListener() //unsubscribe when unmount\n  }, [])\n\n  const handleAddClick = () => {\n    setEditingAddress(new AddressFormType())\n    setMode(ADDINGNEW)\n  }\n\n  const handleEditClick = (addr: any, editingIndex: number) => {\n    const formatted = new AsYouType('US').input(addr.phone)\n    const currentAddress = new AddressFormType({\n      fullname: addr.fullname,\n      line1: addr.line1,\n      line2: addr.line2 || '',\n      city: addr.city,\n      state: addr.state,\n      zipcode: addr.zipcode,\n      phone: addr.phone,\n      formattedPhone: formatted,\n      isValid: false\n    })\n    setEditingAddress(currentAddress)\n    setMode(EDITTING)\n    setEditingIndex(editingIndex)\n  }\n\n  const handleAddressDelete = (addressIndex: number) => {\n    const newAddresses = addresses.slice()\n    newAddresses.splice(addressIndex, 1)\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses))\n  }\n\n  const handleSetAsDefault = (addressIndex: number) => {\n    const newAddresses = addresses.slice()\n    newAddresses.forEach((addr: AddressFormType, i: number) => {\n      if (i === addressIndex) {\n        addr.isDefault = true\n      } else {\n        addr.isDefault = false\n      }\n    })\n    const defaultAddress = newAddresses[addressIndex]\n    newAddresses.splice(addressIndex, 1)\n    newAddresses.unshift(defaultAddress)\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses))\n  }\n\n  const handleAddressSubmit = (newAddress: AddressFormType) => {\n    const newAddresses = addresses.slice()\n    if (mode === EDITTING) {\n      newAddresses.splice(editingIndex, 1, newAddress)\n    } else if (mode === ADDINGNEW) {\n      //if first/only add addr, auto set as default\n      //addr list garantee 1 default addr\n      if (isEmpty(newAddresses)) {\n        newAddress.isDefault = true\n      }\n      newAddresses.push(newAddress)\n    }\n    updateUserAddress(uid, AddressToPureObjectArray(newAddresses))\n    // console.log('Updates/New address: ', newAddress)\n    setMode(DEFAULT)\n    setEditingIndex(-1)\n    setEditingAddress(new AddressFormType())\n  }\n  return (\n    <AccountLayout>\n      <Header>\n        <Typography variant=\"h4\">\n          {mode === EDITTING\n            ? 'Edit your shipping address'\n            : mode === ADDINGNEW\n            ? 'Add shipping address'\n            : 'Manage your shipping address'}\n        </Typography>\n      </Header>\n      {mode === DEFAULT &&\n        !isEmpty(addresses) &&\n        (addresses as any).map((addr: any, i: number) => {\n          return (\n            <AddressBox\n              address={addr}\n              key={`address-${i}`}\n              onEdit={() => handleEditClick(addr, i)}\n              onDelete={() => handleAddressDelete(i)}\n              onSetAsDefault={() => handleSetAsDefault(i)}\n            />\n          )\n        })}\n      {mode !== DEFAULT && (\n        <AddressForm\n          initAddress={editingAddress}\n          submitBtn={{ label: 'Save', handleClick: handleAddressSubmit }}\n          handleCancel={() => setMode(DEFAULT)}\n        />\n      )}\n\n      {mode === DEFAULT && (\n        <RoundedBtn onClick={handleAddClick}>Add address</RoundedBtn>\n      )}\n    </AccountLayout>\n  )\n}\n\nAddress.getInitialProps = async function(ctx: any) {\n  const { store, isServer } = ctx\n  const { isLoggedin } = store.getState().user\n  if (!isLoggedin) {\n    if (isServer) {\n      ctx.res.writeHead(302, { Location: `/` })\n      ctx.res.end()\n    } else {\n      Router.push('/')\n    }\n  }\n  return {\n    isServer\n  }\n}\n"]},"metadata":{},"sourceType":"module"}